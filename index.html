<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BullDrop Style - Games</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #0b0d17;
            --card-bg: #161a23;
            --accent-blue: #246bfd;
            --btn-green: #10b981;
            --btn-red: #ef4444;
            --star-gold: #ffcd00;
            --text-main: #ffffff;
            --text-gray: #8e8e93;
            /* Цвета BullDrop */
            --c-2x: #2d3446; 
            --c-3x: #10b981;
            --c-5x: #ef4444;
            --c-50x: #f59e0b;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding: 0; 
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* ТВОЙ HEADER */
        .top-nav {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 20px; background: rgba(11, 13, 23, 0.9);
            backdrop-filter: blur(20px); z-index: 100; position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .balance-badge {
            background: rgba(36, 107, 253, 0.15); padding: 6px 14px; border-radius: 20px;
            display: flex; align-items: center; gap: 6px; border: 1px solid rgba(36, 107, 253, 0.3);
            font-weight: 700; font-size: 14px;
        }

        /* ЭКРАНЫ */
        .main-container { height: calc(100vh - 135px); overflow-y: auto; }
        .screen { display: none; padding: 15px; animation: fadeUp 0.3s ease-out; }
        .screen.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* BULLDROP WHEEL (ЛЕНТА) */
        .wheel-section {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 20px 0;
            margin-top: 10px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .roulette-viewport {
            width: 100%;
            height: 100px;
            position: relative;
            overflow: hidden;
            background: #0d1018;
            margin: 15px 0;
            border-top: 1px solid rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .selector-line {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 3px;
            background: #fff; transform: translateX(-50%); z-index: 10;
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }

        .wheel-track {
            display: flex;
            position: absolute;
            left: 0;
            height: 100%;
            align-items: center;
            will-change: transform;
        }

        .wheel-item {
            min-width: 80px;
            height: 80px;
            margin: 0 4px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            color: rgba(255,255,255,0.9);
        }

        /* Стили ячеек */
        .i-2 { background: var(--c-2x); box-shadow: inset 0 -4px 0 rgba(0,0,0,0.2); }
        .i-3 { background: var(--c-3x); box-shadow: inset 0 -4px 0 rgba(0,0,0,0.2); }
        .i-5 { background: var(--c-5x); box-shadow: inset 0 -4px 0 rgba(0,0,0,0.2); }
        .i-50 { background: var(--c-50x); color: #000; box-shadow: inset 0 -4px 0 rgba(0,0,0,0.2); }

        /* УПРАВЛЕНИЕ СТАВКАМИ */
        .bet-controls { padding: 0 15px; }
        .input-group {
            display: flex; background: #0d1018; border-radius: 12px; padding: 5px; margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .input-group input {
            flex: 1; background: transparent; border: none; color: white;
            font-weight: 700; font-size: 18px; padding-left: 10px; outline: none;
        }
        .bet-tool { background: #2d3446; border: none; color: #fff; padding: 8px 12px; border-radius: 8px; font-weight: 700; margin-left: 5px; }

        .multipliers-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px;
        }
        .m-card {
            background: #1e232f; height: 60px; border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 2px solid transparent; transition: 0.2s; cursor: pointer;
        }
        .m-card.active { border-color: var(--accent-blue); background: #242b3d; }
        .m-card span:first-child { font-size: 16px; font-weight: 900; }
        .m-card span:last-child { font-size: 9px; opacity: 0.5; font-weight: 700; }

        .spin-btn {
            width: 100%; padding: 18px; border: none; border-radius: 16px;
            background: linear-gradient(135deg, #246bfd 0%, #1a50c4 100%);
            color: white; font-weight: 800; font-size: 16px; text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(36, 107, 253, 0.3);
        }
        .spin-btn:disabled { opacity: 0.5; }

        /* ПРОФИЛЬ (ТВОЙ) */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .big-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--accent-blue); margin: 0 auto 10px; background-size: cover; }
        .menu-row {
            background: var(--card-bg); padding: 18px; border-radius: 18px; 
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
        }

        /* НИЖНЯЯ ПАНЕЛЬ */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #161922; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.05); padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { text-align: center; font-size: 10px; color: var(--text-gray); opacity: 0.6; }
        .nav-item.active { color: var(--accent-blue); opacity: 1; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div style="font-weight: 900; font-size: 18px;">BULL <span style="color:var(--accent-blue)">DROP</span></div>
        <div class="balance-badge">
            <i class="fas fa-star" style="color:var(--star-gold)"></i> <span id="bal-top">2,000</span>
        </div>
    </div>

    <div class="main-container">
        
        <div id="scr-games" class="screen active">
            <h2 style="margin: 5px 0 15px; font-size: 20px;">Колесо Фортуны</h2>
            
            <div class="wheel-section">
                <div class="roulette-viewport">
                    <div class="selector-line"></div>
                    <div class="wheel-track" id="track"></div>
                </div>

                <div class="bet-controls">
                    <div class="input-group">
                        <input type="number" id="bet-amount" value="100">
                        <button class="bet-tool" onclick="adjustBet(0.5)">1/2</button>
                        <button class="bet-tool" onclick="adjustBet(2)">x2</button>
                    </div>

                    <div class="multipliers-grid">
                        <div class="m-card" onclick="selectM(2, this)" style="color:var(--c-2x)">
                            <span>2x</span><span>СЕРЫЙ</span>
                        </div>
                        <div class="m-card" onclick="selectM(3, this)" style="color:var(--c-3x)">
                            <span>3x</span><span>ЗЕЛЕНЫЙ</span>
                        </div>
                        <div class="m-card" onclick="selectM(5, this)" style="color:var(--c-5x)">
                            <span>5x</span><span>КРАСНЫЙ</span>
                        </div>
                        <div class="m-card" onclick="selectM(50, this)" style="color:var(--c-50x)">
                            <span>50x</span><span>GOLD</span>
                        </div>
                    </div>

                    <button class="spin-btn" id="btn-spin" onclick="startSpin()">Сделать ставку</button>
                </div>
            </div>
            
            <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.03); border-radius:15px; font-size:12px; color:var(--text-gray);">
                <i class="fas fa-info-circle"></i> Выберите множитель и введите сумму Stars. При выпадении выбранного цвета ваша ставка умножается!
            </div>
        </div>

        <div id="scr-profile" class="screen">
            <div class="profile-header">
                <div class="big-avatar" id="p-img" style="background-image: url('https://img.icons8.com/3d-fluency/188/user-male-circle.png');"></div>
                <h2 id="p-name" style="margin: 0;">Игрок</h2>
                <div style="font-size: 13px; color: var(--text-gray); margin-top: 5px;" id="p-id">ID: 12345678</div>
            </div>

            <div class="menu-row">
                <span style="font-weight: 700;"><i class="fas fa-history" style="color:var(--accent-blue); width:25px;"></i> История игр</span>
                <i class="fas fa-chevron-right" style="opacity: 0.5; font-size: 12px;"></i>
            </div>
            <div class="menu-row">
                <span style="font-weight: 700;"><i class="fas fa-gift" style="color:var(--btn-green); width:25px;"></i> Промокоды</span>
                <i class="fas fa-chevron-right" style="opacity: 0.5; font-size: 12px;"></i>
            </div>
        </div>

    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="n-games" onclick="goTo('games')"><i class="fas fa-gamepad"></i>Игры</div>
        <div class="nav-item" id="n-profile" onclick="goTo('profile')"><i class="fas fa-user-circle"></i>Профиль</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let balance = 2000;
        let selectedMultiplier = null;
        let isSpinning = false;

        // Генерация ленты (BullDrop Pattern)
        const track = document.getElementById('track');
        const pattern = [2, 3, 2, 5, 2, 3, 2, 5, 2, 3, 2, 50, 2, 5, 2, 3, 2, 5, 2, 3]; // Распределение множителей
        const cardWidth = 88; // 80px + 8px margin

        function initWheel() {
            track.innerHTML = '';
            // Создаем 80 элементов для бесконечного эффекта
            for(let i=0; i<80; i++) {
                const val = pattern[i % pattern.length];
                const div = document.createElement('div');
                div.className = `wheel-item i-${val}`;
                div.innerText = val + 'x';
                track.appendChild(div);
            }
        }
        initWheel();

        function selectM(val, el) {
            if(isSpinning) return;
            selectedMultiplier = val;
            document.querySelectorAll('.m-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            tg.HapticFeedback.selectionChanged();
        }

        function adjustBet(factor) {
            const inp = document.getElementById('bet-amount');
            inp.value = Math.floor(inp.value * factor);
        }

        function startSpin() {
            const bet = parseInt(document.getElementById('bet-amount').value);
            if(isSpinning || !selectedMultiplier || bet > balance || bet <= 0) {
                if(!selectedMultiplier) tg.showAlert("Выберите множитель!");
                return;
            }

            balance -= bet;
            updateUI();
            isSpinning = true;
            document.getElementById('btn-spin').disabled = true;

            // Выбираем случайную победную карточку в конце ленты
            const winIndex = 50 + Math.floor(Math.random() * 20);
            const winValue = pattern[winIndex % pattern.length];
            
            const offset = (winIndex * cardWidth) - (window.innerWidth / 2) + (cardWidth / 2);
            
            track.style.transition = 'transform 5s cubic-bezier(0.1, 0, 0.1, 1)';
            track.style.transform = `translateX(-${offset}px)`;

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('btn-spin').disabled = false;
                
                if(winValue === selectedMultiplier) {
                    const win = bet * winValue;
                    balance += win;
                    tg.showAlert(`Победа! Вы выиграли ${win} Stars`);
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    tg.HapticFeedback.notificationOccurred('error');
                }

                updateUI();
                
                // Мягкий сброс ленты для следующего раза
                setTimeout(() => {
                    track.style.transition = 'none';
                    track.style.transform = `translateX(0px)`;
                    initWheel();
                }, 500);

            }, 5200);
        }

        function updateUI() {
            document.getElementById('bal-top').innerText = balance.toLocaleString();
        }

        function goTo(name) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('scr-' + name).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('n-' + name).classList.add('active');
        }

        // Заполнение данных профиля из TG
        const u = tg.initDataUnsafe?.user;
        if(u) {
            document.getElementById('p-name').innerText = u.first_name;
            document.getElementById('p-id').innerText = "ID: " + u.id;
            if(u.photo_url) document.getElementById('p-img').style.backgroundImage = `url(${u.photo_url})`;
        }
    </script>
</body>
</html>

