<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gifts Battle Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #0b0d17;
            --card-bg: rgba(26, 28, 46, 0.95);
            --accent-blue: #246bfd;
            --btn-green: #2ecc71;
            --star-gold: #ffcd00;
            --text-main: #ffffff;
            --text-gray: #8e8e93;
            --transition: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding: 0; 
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* –≠–õ–ï–ú–ï–ù–¢–´ */
        .gold-star {
            display: inline-block; width: 18px; height: 18px;
            background: url('https://img.icons8.com/emoji/48/star-emoji.png') no-repeat center;
            background-size: contain; vertical-align: sub;
            filter: drop-shadow(0 0 5px rgba(255, 205, 0, 0.5));
        }

        .top-nav {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 20px; background: rgba(11, 13, 23, 0.9);
            backdrop-filter: blur(20px); z-index: 100; position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .balance-badge {
            background: rgba(36, 107, 253, 0.15); padding: 6px 14px; border-radius: 20px;
            display: flex; align-items: center; gap: 6px; border: 1px solid rgba(36, 107, 253, 0.3);
            cursor: pointer; transition: var(--transition); font-weight: 700; font-size: 14px;
        }
        .balance-badge:active { transform: scale(0.95); background: rgba(36, 107, 253, 0.25); }

        /* –≠–ö–†–ê–ù–´ */
        .main-container { height: calc(100vh - 135px); overflow-y: auto; scroll-behavior: smooth; padding-bottom: 20px; }
        .screen { display: none; padding: 15px; animation: fadeUp 0.3s ease-out; }
        .screen.active { display: block; }

        /* –ö–ï–ô–°–´ */
        .cases-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .case-card {
            background: var(--card-bg); border-radius: 20px; padding: 15px 10px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05);
            transition: var(--transition); position: relative;
        }
        .case-card:active { transform: scale(0.96); }
        .case-card img { width: 80%; border-radius: 12px; margin-bottom: 10px; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3)); }
        
        .price-btn { 
            background: #23263d; border-radius: 10px; padding: 8px; 
            font-weight: 800; font-size: 13px; margin-top: 5px; display: inline-flex; align-items: center; gap: 5px;
        }

        /* –ò–ì–†–ê (–†–£–õ–ï–¢–ö–ê) */
        .case-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .back-btn { width: 36px; height: 36px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .back-btn:active { background: rgba(255,255,255,0.1); }

        .main-case-img { width: 160px; height: 160px; margin: 10px auto 30px; display: block; filter: drop-shadow(0 0 40px rgba(36, 107, 253, 0.3)); animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }

        /* –õ–ï–ù–¢–ê */
        .roulette-wrapper {
            width: 100%; height: 110px; background: #0e0f19;
            border-radius: 16px; border: 2px solid var(--accent-blue);
            margin-bottom: 25px; overflow: hidden; position: relative;
            display: none; box-shadow: inset 0 0 30px #000;
        }
        .roulette-track { display: flex; height: 100%; align-items: center; width: max-content; will-change: transform; }
        .roulette-card {
            width: 90px; height: 90px; margin: 0 4px;
            background: radial-gradient(circle, #23263d 0%, #151725 100%);
            border-radius: 12px; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border: 1px solid rgba(255,255,255,0.05); flex-shrink: 0;
        }
        .roulette-card img { width: 55px; height: 55px; margin-bottom: 5px; }
        .selector-line {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 4px;
            background: #fff; transform: translateX(-50%); z-index: 10;
            box-shadow: 0 0 15px white; border-radius: 2px;
        }

        .spin-btn {
            background: linear-gradient(135deg, #246bfd 0%, #1a50c4 100%);
            color: white; border: none; width: 100%; padding: 18px;
            border-radius: 16px; font-weight: 800; font-size: 17px;
            box-shadow: 0 5px 20px rgba(36, 107, 253, 0.3);
            margin-bottom: 15px; cursor: pointer; transition: var(--transition);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .spin-btn:active { transform: scale(0.97); }
        .spin-btn:disabled { opacity: 0.6; filter: grayscale(1); }

        /* –°–ï–¢–ö–ê –ü–†–ï–î–ú–ï–¢–û–í */
        .items-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding-bottom: 20px; }
        .item-box {
            background: rgba(255,255,255,0.03); border-radius: 14px; padding: 10px 5px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05); position: relative;
        }
        .item-box img { width: 50px; height: 50px; display: block; margin: 0 auto 5px; }
        .item-name { font-size: 10px; color: #ccc; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .item-price { font-size: 11px; font-weight: 700; color: var(--star-gold); margin-top: 3px; }

        /* –ü–†–û–§–ò–õ–¨ */
        .profile-header { text-align: center; margin-bottom: 30px; }
        .big-avatar { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--accent-blue); margin: 0 auto 15px; background-size: cover; background-position: center; box-shadow: 0 0 30px rgba(36, 107, 253, 0.2); }
        .menu-row {
            background: var(--card-bg); padding: 18px; border-radius: 18px; 
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: var(--transition);
        }
        .menu-row:active { transform: scale(0.98); background: rgba(255,255,255,0.08); }

        /* –ò–ù–í–ï–ù–¢–ê–†–¨ */
        .inventory-empty { text-align: center; color: var(--text-gray); margin-top: 50px; font-size: 14px; }
        .inv-item { position: relative; }
        .sell-hint { font-size: 9px; color: var(--btn-green); font-weight: 700; margin-top: 2px; }

        /* –ú–û–î–ê–õ–ö–ê –í–´–ò–ì–†–´–®–ê */
        .reward-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(10px);
        }
        .reward-overlay.active { opacity: 1; pointer-events: all; }
        .reward-card {
            width: 85%; background: #151725; border-radius: 24px; padding: 25px; text-align: center;
            border: 1px solid rgba(255,255,255,0.1); transform: scale(0.8); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .reward-overlay.active .reward-card { transform: scale(1); }
        
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 25px; }
        .btn-act { padding: 14px; border-radius: 12px; font-weight: 700; border: none; font-size: 13px; cursor: pointer; color: white; }
        .btn-keep { background: rgba(255,255,255,0.1); }
        .btn-sell { background: var(--btn-green); color: #000; }

        /* –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(22, 25, 44, 0.95); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.05); z-index: 80; backdrop-filter: blur(10px); padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { text-align: center; font-size: 10px; color: var(--text-gray); opacity: 0.6; transition: 0.2s; }
        .nav-item.active { color: var(--accent-blue); opacity: 1; transform: translateY(-2px); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div style="font-weight: 900; font-size: 18px;">GIFTS <span style="color:var(--accent-blue)">BATTLE</span></div>
        <div class="balance-badge" onclick="addBal()">
            <div class="gold-star"></div> <span id="bal-top">0</span>
        </div>
    </div>

    <div class="main-container">
        
        <div id="scr-cases" class="screen active">
            <h2 style="margin: 10px 0 20px; font-size: 22px;">–ú–∞–≥–∞–∑–∏–Ω –ö–µ–π—Å–æ–≤</h2>
            <div class="cases-grid">
                <div class="case-card" onclick="openCaseGame()">
                    <img src="https://img.icons8.com/3d-fluency/188/gift.png">
                    <div style="font-size:15px; font-weight:700;">–°–µ–≤–µ—Ä–Ω–æ–µ –°–∏—è–Ω–∏–µ</div>
                    <div class="price-btn"><div class="gold-star"></div> 250</div>
                </div>
                <div class="case-card" style="opacity: 0.7;">
                    <img src="https://img.icons8.com/3d-fluency/188/christmas-tree.png">
                    <div style="font-size:15px; font-weight:700;">–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –ï–ª–∫–∞</div>
                    <div class="price-btn"><div class="gold-star"></div> 600</div>
                </div>
                <div class="case-card" style="opacity: 0.7;">
                    <img src="https://img.icons8.com/3d-fluency/188/santa-claus.png">
                    <div style="font-size:15px; font-weight:700;">–°–µ–∫—Ä–µ—Ç—ã –°–∞–Ω—Ç—ã</div>
                    <div class="price-btn"><div class="gold-star"></div> 1300</div>
                </div>
                <div class="case-card" style="opacity: 0.7;">
                    <img src="https://img.icons8.com/3d-fluency/188/sleigh.png">
                    <div style="font-size:15px; font-weight:700;">–≠–∫—Å–ø—Ä–µ—Å—Å</div>
                    <div class="price-btn"><div class="gold-star"></div> 3000</div>
                </div>
            </div>
        </div>

        <div id="scr-game" class="screen">
            <div class="case-header">
                <div class="back-btn" onclick="goToScreen('cases')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0; font-size: 18px;">–°–µ–≤–µ—Ä–Ω–æ–µ –°–∏—è–Ω–∏–µ</h3>
            </div>

            <img src="https://img.icons8.com/3d-fluency/188/gift.png" class="main-case-img" id="static-case-img">

            <div class="roulette-wrapper" id="roulette-box">
                <div class="selector-line"></div>
                <div class="roulette-track" id="track"></div>
            </div>

            <div style="background: #151725; padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05);">
                <button class="spin-btn" id="btn-spin" onclick="playRoulette()">
                    –û–¢–ö–†–´–¢–¨ –ó–ê <div class="gold-star"></div> 250
                </button>
                <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--text-gray);">
                    <span><i class="fas fa-check-circle" style="color:var(--btn-green)"></i> –ß–µ—Å—Ç–Ω—ã–µ —à–∞–Ω—Å—ã</span>
                    <span>–í–µ–∑–µ–Ω–∏–µ: <b>x1</b></span>
                </div>
            </div>

            <div style="margin: 25px 0 10px; font-size: 14px; font-weight: 700; color:var(--text-gray);">–°–û–î–ï–†–ñ–ò–ú–û–ï –ö–ï–ô–°–ê:</div>
            <div class="items-grid" id="case-contents"></div>
        </div>

        <div id="scr-profile" class="screen">
            <div class="profile-header">
                <div class="big-avatar" id="p-img" style="background-image: url('https://img.icons8.com/3d-fluency/188/user-male-circle.png');"></div>
                <h2 id="p-name" style="margin: 0;">–ò–≥—Ä–æ–∫</h2>
                <div style="font-size: 13px; color: var(--text-gray); margin-top: 5px;" id="p-id">ID: –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>

            <div class="menu-row" onclick="goToScreen('inventory')">
                <span style="font-weight: 700;"><i class="fas fa-box" style="color:var(--accent-blue); width:25px;"></i> –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
                <i class="fas fa-chevron-right" style="opacity: 0.5; font-size: 12px;"></i>
            </div>
            <div class="menu-row">
                <span style="font-weight: 700;"><i class="fas fa-star" style="color:var(--star-gold); width:25px;"></i> –ö—É–ø–∏—Ç—å Stars</span>
                <i class="fas fa-chevron-right" style="opacity: 0.5; font-size: 12px;"></i>
            </div>
            <div class="menu-row">
                <span style="font-weight: 700;"><i class="fas fa-cog" style="color: #95a5a6; width:25px;"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                <i class="fas fa-chevron-right" style="opacity: 0.5; font-size: 12px;"></i>
            </div>
        </div>

        <div id="scr-inventory" class="screen">
            <div class="case-header">
                <div class="back-btn" onclick="goToScreen('profile')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0; font-size: 18px;">–ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
            </div>
            <div class="items-grid" id="inv-grid"></div>
            <div id="inv-empty" class="inventory-empty" style="display:none;">–ü—É—Å—Ç–æ... –û—Ç–∫—Ä–æ–π –ø–∞—Ä—É –∫–µ–π—Å–æ–≤! üì¶</div>
        </div>

    </div>

    <div class="reward-overlay" id="reward-modal">
        <div class="reward-card">
            <div style="font-size:12px; color:var(--text-gray); font-weight:700; letter-spacing: 1px; margin-bottom: 15px;">–¢–í–û–ô –í–´–ò–ì–†–´–®</div>
            <div style="width: 150px; height: 150px; background: radial-gradient(closest-side, rgba(36,107,253,0.3), transparent); margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                <img id="rew-img" src="" style="width:100px; height:100px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));">
            </div>
            <div id="rew-name" style="font-size:20px; font-weight:800; margin: 10px 0 5px;">Item Name</div>
            <div style="font-size:15px; color:var(--text-gray);">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span style="color:var(--star-gold); font-weight:700;"><div class="gold-star"></div> <span id="rew-price">0</span></span></div>

            <div class="action-btns">
                <button class="btn-act btn-sell" onclick="finishReward('sell')">
                    –ü–†–û–î–ê–¢–¨<br><span style="font-size:10px; opacity:0.8">+<span id="btn-sell-price">0</span> Stars</span>
                </button>
                <button class="btn-act btn-keep" onclick="finishReward('keep')">
                    –ó–ê–ë–†–ê–¢–¨<br><span style="font-size:10px; opacity:0.6">–í –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="n-cases" onclick="goToScreen('cases')"><i class="fas fa-box-open"></i>–ö–µ–π—Å—ã</div>
        <div class="nav-item" id="n-profile" onclick="goToScreen('profile')"><i class="fas fa-user-circle"></i>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // === –î–ê–ù–ù–´–ï ===
        let balance = parseInt(localStorage.getItem('balance_v5')) || 2000;
        let inventory = JSON.parse(localStorage.getItem('inventory_v5')) || [];
        
        // –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–¶–µ–Ω—ã –∏ —à–∞–Ω—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∫–∏)
        // weight: —á–µ–º –±–æ–ª—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å
        const itemsDB = [
            { id: 1, name: 'Snow Globe Pepe', price: 5000, img: 'https://img.icons8.com/3d-fluency/94/snow-globe.png', weight: 1, rare: true },
            { id: 2, name: 'Diamond Ring', price: 4800, img: 'https://img.icons8.com/3d-fluency/94/diamond-ring.png', weight: 2, rare: true },
            { id: 3, name: 'Golden Pacifier', price: 3700, img: 'https://img.icons8.com/3d-fluency/94/pacifier.png', weight: 5 },
            { id: 4, name: 'Polar Bear', price: 2900, img: 'https://img.icons8.com/3d-fluency/94/bear.png', weight: 8 },
            { id: 5, name: 'Ice Crystal', price: 2700, img: 'https://img.icons8.com/3d-fluency/94/crystal.png', weight: 12 },
            { id: 6, name: 'Cupid Heart', price: 1600, img: 'https://img.icons8.com/3d-fluency/94/heart-with-arrow.png', weight: 20 },
            { id: 7, name: 'Monkey Toy', price: 1200, img: 'https://img.icons8.com/3d-fluency/94/monkey.png', weight: 30 },
            { id: 8, name: 'Ginger House', price: 900, img: 'https://img.icons8.com/3d-fluency/94/gingerbread-house.png', weight: 45 },
            { id: 9, name: 'Money Bag', price: 500, img: 'https://img.icons8.com/3d-fluency/94/money-bag.png', weight: 70 },
            { id: 10, name: 'Lollipop', price: 450, img: 'https://img.icons8.com/3d-fluency/94/lollipop.png', weight: 100 },
            { id: 11, name: 'Frog Plush', price: 180, img: 'https://img.icons8.com/3d-fluency/94/frog.png', weight: 150 },
            { id: 12, name: 'Love Locket', price: 150, img: 'https://img.icons8.com/3d-fluency/94/necklace.png', weight: 200 },
            { id: 13, name: 'Peach', price: 100, img: 'https://img.icons8.com/3d-fluency/94/peach.png', weight: 300 },
            { id: 14, name: 'Blue Cap', price: 50, img: 'https://img.icons8.com/3d-fluency/94/baseball-cap.png', weight: 400 }
        ];

        // === –°–ò–°–¢–ï–ú–ê ===
        function updateUI() {
            document.getElementById('bal-top').innerText = balance.toLocaleString();
            localStorage.setItem('balance_v5', balance);
            localStorage.setItem('inventory_v5', JSON.stringify(inventory));
        }
        updateUI();

        function addBal() {
            balance += 1000; 
            updateUI(); 
            tg.HapticFeedback.notificationOccurred('success');
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function goToScreen(name) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('scr-' + name).classList.add('active');
            
            // –ú–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(name === 'cases' || name === 'game') document.getElementById('n-cases').classList.add('active');
            if(name === 'profile' || name === 'inventory') document.getElementById('n-profile').classList.add('active');

            // –°–±—Ä–æ—Å –∏–≥—Ä—ã
            if(name !== 'game') {
                document.getElementById('roulette-box').style.display = 'none';
                document.getElementById('static-case-img').style.display = 'block';
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            if(name === 'inventory') renderInventory();
        }

        // === –ò–ì–†–ê ===
        function openCaseGame() {
            goToScreen('game');
            const grid = document.getElementById('case-contents');
            grid.innerHTML = '';
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –¥–æ—Ä–æ–≥–∏–µ –ø–µ—Ä–≤—ã–º–∏
            const sorted = [...itemsDB].sort((a,b) => b.price - a.price);
            sorted.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item-box';
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–¥–∫–∏—Ö
                if(item.price > 2000) div.style.borderColor = item.price > 4000 ? '#ffcd00' : '#246bfd';
                div.innerHTML = `
                    <img src="${item.img}">
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">${item.price}</div>
                `;
                grid.appendChild(div);
            });
        }

        let isSpinning = false;
        let currentWinItem = null;

        function getRandomItem() {
            let total = itemsDB.reduce((acc, i) => acc + i.weight, 0);
            let rand = Math.random() * total;
            for(let i of itemsDB) {
                if(rand < i.weight) return i;
                rand -= i.weight;
            }
            return itemsDB[itemsDB.length-1];
        }

        function playRoulette() {
            if(isSpinning || balance < 250) {
                if(balance < 250) tg.showAlert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç Stars!");
                return;
            }
            
            balance -= 250;
            updateUI();
            isSpinning = true;
            document.getElementById('btn-spin').disabled = true;
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ UI
            document.getElementById('static-case-img').style.display = 'none';
            const box = document.getElementById('roulette-box');
            box.style.display = 'block';
            const track = document.getElementById('track');
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–µ–Ω—Ç—ã
            track.innerHTML = '';
            track.style.transition = 'none';
            track.style.transform = 'translateX(0)';
            
            const winItem = getRandomItem();
            currentWinItem = winItem;
            const winIndex = 30; // –ü–æ–∑–∏—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–∞
            
            for(let i=0; i<45; i++) {
                let item = (i === winIndex) ? winItem : itemsDB[Math.floor(Math.random()*itemsDB.length)];
                let div = document.createElement('div');
                div.className = 'roulette-card';
                if(item.rare) div.style.border = '1px solid ' + (item.price > 4000 ? '#ffcd00' : '#246bfd');
                div.innerHTML = `<img src="${item.img}">`;
                track.appendChild(div);
            }

            // –í—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ
            // box width = 100vw - 40px (approx), let's say center is relative
            // card width 90 + 8 margin = 98px
            // Center of winner needs to align with center of box
            const cardWidth = 98;
            const boxCenter = box.offsetWidth / 2;
            const itemCenter = cardWidth / 2;
            const scrollPos = (winIndex * cardWidth) - boxCenter + itemCenter;
            
            // –°—Ç–∞—Ä—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞
            setTimeout(() => {
                track.style.transition = 'transform 4.5s cubic-bezier(0.1, 0, 0.1, 1)';
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–Ω–¥–æ–º–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ +- 20px
                const randOffset = Math.floor(Math.random() * 30) - 15;
                track.style.transform = `translateX(-${scrollPos + randOffset}px)`;
                tg.HapticFeedback.impactOccurred('medium');
            }, 50);

            setTimeout(() => {
                showRewardModal(winItem);
                isSpinning = false;
                document.getElementById('btn-spin').disabled = false;
            }, 4600);
        }

        // === –ú–û–î–ê–õ–ö–ê –í–´–ò–ì–†–´–®–ê ===
        function showRewardModal(item) {
            tg.HapticFeedback.notificationOccurred('success');
            const m = document.getElementById('reward-modal');
            document.getElementById('rew-img').src = item.img;
            document.getElementById('rew-name').innerText = item.name;
            document.getElementById('rew-price').innerText = item.price;
            document.getElementById('btn-sell-price').innerText = item.price;
            m.classList.add('active');
        }

        function finishReward(action) {
            const m = document.getElementById('reward-modal');
            m.classList.remove('active');
            
            if(action === 'sell') {
                balance += currentWinItem.price;
                tg.showAlert(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${currentWinItem.price} Stars`);
            } else {
                inventory.push(currentWinItem);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                tg.showAlert("–ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å");
            }
            updateUI();
        }

        // === –ò–ù–í–ï–ù–¢–ê–†–¨ ===
        function renderInventory() {
            const grid = document.getElementById('inv-grid');
            grid.innerHTML = '';
            
            if(inventory.length === 0) {
                document.getElementById('inv-empty').style.display = 'block';
                return;
            }
            document.getElementById('inv-empty').style.display = 'none';

            // –†–∏—Å—É–µ–º –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            [...inventory].reverse().forEach((item, index) => {
                // –ù–∞—Ö–æ–¥–∏–º —Ä–µ–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –º–∞—Å—Å–∏–≤–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                const realIndex = inventory.length - 1 - index;
                
                const div = document.createElement('div');
                div.className = 'item-box inv-item';
                div.onclick = () => sellFromInventory(realIndex, item);
                div.innerHTML = `
                    <img src="${item.img}">
                    <div class="item-name">${item.name}</div>
                    <div class="sell-hint">–ü–†–û–î–ê–¢–¨: ${item.price}</div>
                `;
                grid.appendChild(div);
            });
        }

        function sellFromInventory(index, item) {
            if(confirm(`–ü—Ä–æ–¥–∞—Ç—å ${item.name} –∑–∞ ${item.price} Stars?`)) {
                inventory.splice(index, 1);
                balance += item.price;
                updateUI();
                renderInventory();
                tg.HapticFeedback.selectionChanged();
            }
        }

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø USER ===
        const u = tg.initDataUnsafe?.user;
        if(u) {
            document.getElementById('p-name').innerText = u.first_name + (u.last_name ? ' ' + u.last_name : '');
            document.getElementById('p-id').innerText = "ID: " + u.id;
            if(u.photo_url) document.getElementById('p-img').style.backgroundImage = `url(${u.photo_url})`;
        } else {
            // –§–µ–π–∫ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω–µ –≤ –¢–ì
            document.getElementById('p-id').innerText = "ID: 12345678";
        }

    </script>
</body>
</html>
