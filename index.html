<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gifts Battle Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #0b0d17;
            --card-bg: rgba(26, 28, 46, 0.95);
            --accent-blue: #246bfd;
            --star-gold: #ffcd00;
            --text-main: #ffffff;
            --text-gray: #8e8e93;
            --rarity-common: #b0bec5;
            --rarity-rare: #42a5f5;
            --rarity-legend: #ffca28;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding: 0; 
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* –ó–í–ï–ó–î–ê */
        .gold-star {
            display: inline-block;
            width: 18px; height: 18px;
            background: url('https://img.icons8.com/emoji/48/star-emoji.png') no-repeat center;
            background-size: contain;
            vertical-align: sub;
            filter: drop-shadow(0 0 4px rgba(255, 205, 0, 0.6));
        }

        /* –®–ê–ü–ö–ê */
        .top-nav {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 20px; background: rgba(11, 13, 23, 0.9);
            backdrop-filter: blur(15px); z-index: 80; position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .menu-btn { font-size: 22px; cursor: pointer; transition: var(--transition); padding: 5px; }
        .balance-badge {
            background: rgba(36, 107, 253, 0.15); padding: 6px 14px; border-radius: 20px;
            display: flex; align-items: center; gap: 8px; border: 1px solid rgba(36, 107, 253, 0.3);
            cursor: pointer; transition: var(--transition); font-weight: 700;
        }

        /* –ö–û–ù–¢–ï–ô–ù–ï–†–´ */
        .main-container { height: calc(100vh - 140px); overflow-y: auto; position: relative; scroll-behavior: smooth; }
        .screen { display: none; padding: 15px; animation: screenIn 0.3s ease-out; padding-bottom: 80px; }
        .screen.active { display: block; }
        @keyframes screenIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ì–†–ò–î –ö–ï–ô–°–û–í (–ì–õ–ê–í–ù–ê–Ø) */
        .cases-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .case-card {
            background: var(--card-bg); border-radius: 20px; padding: 12px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05);
            transition: var(--transition); position: relative; overflow: hidden;
        }
        .case-card:active { transform: scale(0.96); }
        .case-card img { width: 100%; border-radius: 12px; margin-bottom: 10px; }
        .price-btn { 
            background: #23263d; border-radius: 10px; padding: 8px; 
            font-weight: 800; font-size: 14px; margin-top: 5px;
        }

        /* –≠–ö–†–ê–ù –û–¢–ö–†–´–¢–ò–Ø –ö–ï–ô–°–ê (–ù–û–í–´–ô) */
        .case-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .back-btn { width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        .main-case-img { width: 180px; height: 180px; margin: 0 auto; display: block; filter: drop-shadow(0 0 30px rgba(36, 107, 253, 0.4)); animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }

        .control-panel { background: #151725; padding: 15px; border-radius: 20px; margin-top: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .spin-btn {
            background: linear-gradient(135deg, #246bfd 0%, #1e5ad6 100%);
            color: white; border: none; width: 100%; padding: 16px;
            border-radius: 14px; font-weight: 800; font-size: 18px;
            box-shadow: 0 4px 15px rgba(36, 107, 253, 0.3);
            margin-bottom: 15px; cursor: pointer; transition: var(--transition);
        }
        .spin-btn:disabled { opacity: 0.6; filter: grayscale(1); cursor: not-allowed; }
        .spin-btn:active:not(:disabled) { transform: scale(0.98); }

        .multipliers { display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; }
        .mult-btn { 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-gray); padding: 8px 16px; border-radius: 10px; font-weight: 700;
        }
        .mult-btn.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }

        .items-label { font-size: 14px; color: var(--text-gray); margin: 20px 0 10px; display: flex; align-items: center; gap: 8px; }
        
        /* –°–ï–¢–ö–ê –°–û–î–ï–†–ñ–ò–ú–û–ì–û –ö–ï–ô–°–ê */
        .case-contents { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .item-preview {
            background: rgba(255,255,255,0.03); border-radius: 12px; padding: 10px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05); position: relative;
        }
        .item-preview img { width: 50px; height: 50px; margin-bottom: 5px; display: block; margin: 0 auto; }
        .item-preview .i-name { font-size: 10px; color: #ccc; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item-preview .i-val { font-size: 11px; font-weight: 700; color: var(--star-gold); margin-top: 4px; }
        
        /* –†–£–õ–ï–¢–ö–ê (–ê–ù–ò–ú–ê–¶–ò–Ø) */
        .roulette-wrapper {
            width: 100%; height: 110px; background: #0e0f19;
            border-radius: 16px; border: 2px solid var(--accent-blue);
            margin-bottom: 20px; overflow: hidden; position: relative;
            display: none; /* –°–∫—Ä—ã—Ç–∞ –ø–æ–∫–∞ –Ω–µ –Ω–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É */
            box-shadow: inset 0 0 20px #000;
        }
        .roulette-track {
            display: flex; height: 100%; align-items: center;
            width: max-content; /* –ß—Ç–æ–±—ã –ª–µ–Ω—Ç–∞ –±—ã–ª–∞ –¥–ª–∏–Ω–Ω–æ–π */
            will-change: transform;
        }
        .roulette-card {
            width: 90px; height: 90px; margin: 0 4px;
            background: radial-gradient(circle at center, rgba(40,44,68,1) 0%, rgba(20,22,35,1) 100%);
            border-radius: 10px; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border: 1px solid rgba(255,255,255,0.1); flex-shrink: 0;
        }
        .roulette-card img { width: 50px; height: 50px; }
        .selector-line {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 4px;
            background: #fff; transform: translateX(-50%); z-index: 10;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            border-radius: 2px;
        }

        /* –ú–û–î–ê–õ–ö–ê –í–´–ò–ì–†–´–®–ê */
        .reward-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(10px);
        }
        .reward-overlay.active { opacity: 1; pointer-events: all; }
        .reward-card {
            transform: scale(0.5); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }
        .reward-overlay.active .reward-card { transform: scale(1); }
        .glow-bg {
            width: 200px; height: 200px; background: radial-gradient(circle, var(--accent-blue) 0%, transparent 70%);
            position: absolute; z-index: -1; animation: pulse 2s infinite;
        }

        /* –ü–†–û–§–ò–õ–¨ –ò –ú–ï–ù–Æ (–°—Ç–∞—Ä–æ–µ) */
        .profile-content { text-align: center; padding-top: 20px; }
        .big-avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--accent-blue); margin: 0 auto 15px; background-size: cover; }
        .btn-box { background: var(--card-bg); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); }

        /* –°–ê–ô–î–ë–ê–† */
        .side-menu { position: fixed; top: 0; left: -100%; width: 80%; height: 100%; background: #0e0f19; z-index: 1000; transition: 0.3s; padding: 20px; border-right: 1px solid rgba(255,255,255,0.1); }
        .side-menu.active { left: 0; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:900; display:none; }
        .overlay.active { display:block; }

        /* –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(22, 25, 44, 0.95); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.05); z-index: 80; backdrop-filter: blur(10px); }
        .nav-item { text-align: center; font-size: 10px; color: var(--text-gray); opacity: 0.6; }
        .nav-item.active { color: var(--accent-blue); opacity: 1; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }

    </style>
</head>
<body>

    <div class="top-nav">
        <div class="menu-btn" onclick="openMenu()"><i class="fas fa-bars"></i></div>
        <div style="font-weight: 900; font-size: 18px;">GIFTS <span style="color:var(--accent-blue)">BATTLE</span></div>
        <div class="balance-badge" onclick="addBal()">
            <div class="gold-star"></div> <span id="bal-top" style="margin-left:5px">0</span>
        </div>
    </div>

    <div class="main-container">
        
        <div id="scr-cases" class="screen active">
            <h2 style="margin: 10px 0 20px;">–ú–∞–≥–∞–∑–∏–Ω –ö–µ–π—Å–æ–≤</h2>
            <div class="cases-grid">
                <div class="case-card" onclick="openCaseDetail('north')">
                    <img src="https://i.imgur.com/mY7Yn8X.png">
                    <div style="font-size:14px; font-weight:700;">–°–µ–≤–µ—Ä–Ω–æ–µ –°–∏—è–Ω–∏–µ</div>
                    <div class="price-btn"><div class="gold-star"></div> 250</div>
                </div>
                
                <div class="case-card">
                    <img src="https://i.imgur.com/E9hP8nQ.png">
                    <div style="font-size:14px; font-weight:700;">–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –ï–ª–∫–∞</div>
                    <div class="price-btn"><div class="gold-star"></div> 600</div>
                </div>
                <div class="case-card" style="opacity:0.5"><img src="https://i.imgur.com/mY7Yn8X.png"><div style="font-size:13px">–°–µ–∫—Ä–µ—Ç—ã</div><div class="price-btn">1300</div></div>
                <div class="case-card" style="opacity:0.5"><img src="https://i.imgur.com/E9hP8nQ.png"><div style="font-size:13px">–≠–∫—Å–ø—Ä–µ—Å—Å</div><div class="price-btn">3000</div></div>
            </div>
        </div>

        <div id="scr-game" class="screen">
            <div class="case-header">
                <div class="back-btn" onclick="goToScreen('cases')"><i class="fas fa-arrow-left"></i></div>
                <h3 style="margin:0">–°–µ–≤–µ—Ä–Ω–æ–µ –°–∏—è–Ω–∏–µ</h3>
            </div>

            <img src="https://i.imgur.com/mY7Yn8X.png" class="main-case-img" id="static-case-img">

            <div class="roulette-wrapper" id="roulette-box">
                <div class="selector-line"></div>
                <div class="roulette-track" id="track"></div>
            </div>

            <div class="control-panel">
                <div class="multipliers">
                    <div class="mult-btn active">x1</div>
                    <div class="mult-btn">x2</div>
                    <div class="mult-btn">x3</div>
                </div>

                <button class="spin-btn" id="btn-spin" onclick="playRoulette()">
                    –û–¢–ö–†–´–¢–¨ –ó–ê <div class="gold-star"></div> 250
                </button>

                <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:700; color:var(--accent-blue);">
                    <span><i class="fas fa-play"></i> –î–µ–º–æ</span>
                    <span><i class="fas fa-gift"></i> –ë–æ–Ω—É—Å—ã</span>
                </div>
            </div>

            <div class="items-label"><i class="fas fa-box-open"></i> –ß—Ç–æ –≤ –∫–µ–π—Å–µ?</div>
            <div class="case-contents" id="items-grid">
                </div>
        </div>

        <div id="scr-profile" class="screen">
            <div class="profile-content">
                <div class="big-avatar" id="p-img"></div>
                <h2 id="p-name">User</h2>
                <div style="color:gray; margin-bottom:20px">ID: 8453400444</div>
                <div class="btn-box"><span>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span> <i class="fas fa-chevron-right"></i></div>
                <div class="btn-box"><span>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span> <i class="fas fa-chevron-right"></i></div>
            </div>
        </div>
    </div>

    <div class="overlay" id="menu-overlay" onclick="closeMenu()"></div>
    <div class="side-menu" id="menu-side">
        <h3 style="color:white">–ú–µ–Ω—é</h3>
        <div style="padding:15px 0; border-bottom:1px solid #333" onclick="goToScreen('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div style="padding:15px 0; border-bottom:1px solid #333">–ü–æ–ø–æ–ª–Ω–∏—Ç—å Stars</div>
        <div style="padding:15px 0; color:#2ecc71">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" id="n-cases" onclick="goToScreen('cases')">
            <i class="fas fa-box"></i> –ö–µ–π—Å—ã
        </div>
        <div class="nav-item" id="n-profile" onclick="goToScreen('profile')">
            <i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å
        </div>
    </div>

    <div class="reward-overlay" id="reward-modal" onclick="closeReward()">
        <div class="glow-bg"></div>
        <div class="reward-card">
            <div style="font-size:20px; font-weight:800; margin-bottom:20px;">–í–´ –ü–û–õ–£–ß–ò–õ–ò:</div>
            <img id="rew-img" src="" style="width:120px; height:120px; margin-bottom:15px; border-radius:15px; box-shadow: 0 0 20px rgba(255,255,255,0.2);">
            <div id="rew-name" style="font-size:18px; font-weight:700; margin-bottom:5px;">Item Name</div>
            <div style="font-size:16px; color:var(--star-gold); font-weight:800;"><div class="gold-star"></div> <span id="rew-price">0</span></div>
            <button onclick="closeReward()" style="margin-top:30px; background:var(--accent-blue); border:none; color:white; padding:12px 40px; border-radius:12px; font-weight:700;">–ó–ê–ë–†–ê–¢–¨</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- –î–ê–ù–ù–´–ï (–ë–∞–ª–∞–Ω—Å –∏ –ü—Ä–µ–¥–º–µ—Ç—ã) ---
        let balance = localStorage.getItem('stars_v4') ? parseInt(localStorage.getItem('stars_v4')) : 1000;
        
        // –ë–î –ü—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ –≤–∏–¥–µ–æ (weight = —à–∞–Ω—Å, —á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º —á–∞—â–µ –ø–∞–¥–∞–µ—Ç)
        // –¶–µ–Ω—ã –≤–∑—è—Ç—ã –∏–∑ –≤–∏–¥–µ–æ
        const caseItems = [
            { id: 1, name: 'Snow Globe Pepe', price: 4950, img: 'https://img.icons8.com/3d-fluency/94/snow-globe.png', weight: 1 },    // –õ–µ–≥–µ–Ω–¥–∞—Ä–∫–∞ (0.1%)
            { id: 2, name: 'Bonded Ring', price: 4884, img: 'https://img.icons8.com/3d-fluency/94/diamond-ring.png', weight: 2 },      // –†–µ–¥–∫–æ–µ
            { id: 3, name: 'Bling Binky', price: 3700, img: 'https://img.icons8.com/3d-fluency/94/jewelry.png', weight: 5 },
            { id: 4, name: 'Toy Bear Polar', price: 2930, img: 'https://img.icons8.com/3d-fluency/94/bear.png', weight: 10 },
            { id: 5, name: 'Ice Artifact', price: 2717, img: 'https://img.icons8.com/3d-fluency/94/crystal.png', weight: 15 },
            { id: 6, name: 'Cupid Charm', price: 1615, img: 'https://img.icons8.com/3d-fluency/94/heart-with-arrow.png', weight: 25 },
            { id: 7, name: 'Jolly Chimp', price: 1187, img: 'https://img.icons8.com/3d-fluency/94/monkey.png', weight: 35 },
            { id: 8, name: 'Snow Globe House', price: 880, img: 'https://img.icons8.com/3d-fluency/94/gingerbread-house.png', weight: 50 },
            { id: 9, name: 'Money Pot', price: 490, img: 'https://img.icons8.com/3d-fluency/94/money-bag.png', weight: 100 },
            { id: 10, name: 'Lol Pop Icicle', price: 440, img: 'https://img.icons8.com/3d-fluency/94/lollipop.png', weight: 150 },     // –ß–∞—Å—Ç–æ–µ
            { id: 11, name: 'Plush Pepe', price: 170, img: 'https://img.icons8.com/3d-fluency/94/frog.png', weight: 200 },
            { id: 12, name: 'Heart Locket', price: 150, img: 'https://img.icons8.com/3d-fluency/94/necklace.png', weight: 250 },
            { id: 13, name: 'Precious Peach', price: 100, img: 'https://img.icons8.com/3d-fluency/94/peach.png', weight: 300 },
            { id: 14, name: 'Durov\'s Cap', price: 50, img: 'https://img.icons8.com/3d-fluency/94/baseball-cap.png', weight: 400 }, // –ú—É—Å–æ—Ä
        ];

        // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---

        function updateBal() {
            document.getElementById('bal-top').innerText = balance.toLocaleString();
            localStorage.setItem('stars_v4', balance);
        }
        updateBal();

        function addBal() {
            // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
            balance += 1000;
            updateBal();
            tg.HapticFeedback.notificationOccurred('success');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        function goToScreen(name) {
            closeMenu();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('scr-' + name).classList.add('active');
            if(document.getElementById('n-' + name)) document.getElementById('n-' + name).classList.add('active');
            
            // –ï—Å–ª–∏ —É—Ö–æ–¥–∏–º —Å —ç–∫—Ä–∞–Ω–∞ –∏–≥—Ä—ã, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if(name !== 'game') {
                document.getElementById('roulette-box').style.display = 'none';
                document.getElementById('static-case-img').style.display = 'block';
            }
        }

        function openMenu() {
            document.getElementById('menu-side').classList.add('active');
            document.getElementById('menu-overlay').classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }
        function closeMenu() {
            document.getElementById('menu-side').classList.remove('active');
            document.getElementById('menu-overlay').classList.remove('active');
        }

        // --- –õ–û–ì–ò–ö–ê –ö–ï–ô–°–û–í –ò –†–£–õ–ï–¢–ö–ò ---

        function openCaseDetail(type) {
            goToScreen('game');
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ "–ß—Ç–æ –≤ –∫–µ–π—Å–µ"
            const grid = document.getElementById('items-grid');
            grid.innerHTML = '';
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º: –¥–æ—Ä–æ–≥–∏–µ —Å–≤–µ—Ä—Ö—É
            const sorted = [...caseItems].sort((a,b) => b.price - a.price);
            
            sorted.forEach(item => {
                const el = document.createElement('div');
                el.className = 'item-preview';
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–µ–¥–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
                let glow = '';
                if(item.price > 2000) glow = 'box-shadow: 0 0 10px rgba(66, 165, 245, 0.3); border-color: #42a5f5;';
                if(item.price > 4000) glow = 'box-shadow: 0 0 10px rgba(255, 202, 40, 0.3); border-color: #ffca28;';
                
                el.style.cssText = glow;
                el.innerHTML = `
                    <img src="${item.img}">
                    <div class="i-name">${item.name}</div>
                    <div class="i-val"><div class="gold-star"></div> ${item.price}</div>
                `;
                grid.appendChild(el);
            });
        }

        // –í–´–ë–û–† –ü–û–ë–ï–î–ò–¢–ï–õ–Ø –ü–û –í–ï–°–ê–ú
        function getRandomItem() {
            let totalWeight = caseItems.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            for (let item of caseItems) {
                if (random < item.weight) return item;
                random -= item.weight;
            }
            return caseItems[caseItems.length - 1];
        }

        let isSpinning = false;

        function playRoulette() {
            if(isSpinning) return;
            const cost = 250;
            
            if(balance < cost) {
                tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Stars! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–∞–ª–∞–Ω—Å.");
                tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
            balance -= cost;
            updateBal();
            isSpinning = true;
            document.getElementById('btn-spin').disabled = true;
            document.getElementById('btn-spin').innerText = "–û–¢–ö–†–´–¢–ò–ï...";

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ UI
            const staticImg = document.getElementById('static-case-img');
            const rouletteBox = document.getElementById('roulette-box');
            const track = document.getElementById('track');

            staticImg.style.display = 'none';
            rouletteBox.style.display = 'block';

            // –ì–ï–ù–ï–†–ê–¶–ò–Ø –õ–ï–ù–¢–´
            // –ù–∞–º –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 30-–π –ø–æ–∑–∏—Ü–∏–∏
            track.innerHTML = '';
            track.style.transition = 'none';
            track.style.transform = 'translateX(0px)';

            const winItem = getRandomItem(); // –ó–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞–µ–º –∫—Ç–æ –≤—ã–∏–≥—Ä–∞–ª
            const cardWidth = 98; // 90px + 8px margin
            const winIndex = 35; // –ò–Ω–¥–µ–∫—Å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ –ª–µ–Ω—Ç–µ (—á—Ç–æ–±—ã –¥–æ–ª–≥–æ –∫—Ä—É—Ç–∏–ª–æ—Å—å)
            
            // –°—Ç—Ä–æ–∏–º –ª–µ–Ω—Ç—É
            for(let i = 0; i < 50; i++) {
                let item;
                if(i === winIndex) {
                    item = winItem;
                } else {
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–º–∏ (—á–∞—â–µ –¥–µ—à–µ–≤—ã–º–∏) –¥–ª—è –≤–∏–∑—É–∞–ª–∞
                    item = caseItems[Math.floor(Math.random() * caseItems.length)];
                }
                
                const card = document.createElement('div');
                card.className = 'roulette-card';
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤ –ª–µ–Ω—Ç–µ
                if(item.price > 2000) card.style.border = "1px solid #42a5f5";
                if(item.price > 4000) card.style.border = "1px solid #ffca28";
                
                card.innerHTML = `<img src="${item.img}">`;
                track.appendChild(card);
            }

            // –ó–ê–ü–£–°–ö –ê–ù–ò–ú–ê–¶–ò–ò
            // –¶–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ (–ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞) - –ø–æ–ª–æ–≤–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
            const containerCenter = rouletteBox.offsetWidth / 2;
            const cardCenter = cardWidth / 2;
            // –°–º–µ—â–µ–Ω–∏–µ: (WinIndex * Width) - (ContainerCenter - CardCenter)
            const finalPos = (winIndex * cardWidth) - (containerCenter - cardCenter);

            // –ù–µ–±–æ–ª—å—à–æ–π —Ä–∞–Ω–¥–æ–º –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–æ–≤–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å
            const randomOffset = Math.floor(Math.random() * 20) - 10; 

            setTimeout(() => {
                track.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0.10, 1)'; // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                track.style.transform = `translateX(-${finalPos + randomOffset}px)`;
                
                // –í–∏–±—Ä–∞—Ü–∏—è –≤ –Ω–∞—á–∞–ª–µ
                tg.HapticFeedback.impactOccurred('medium');
            }, 50);

            // –û–ö–û–ù–ß–ê–ù–ò–ï
            setTimeout(() => {
                tg.HapticFeedback.notificationOccurred('success');
                showReward(winItem);
                isSpinning = false;
                document.getElementById('btn-spin').disabled = false;
                document.getElementById('btn-spin').innerHTML = '–û–¢–ö–†–´–¢–¨ –ï–©–ï <div class="gold-star"></div> 250';
            }, 4100); // 4s –∞–Ω–∏–º–∞—Ü–∏—è + 100ms –∑–∞–ø–∞—Å
        }

        function showReward(item) {
            const modal = document.getElementById('reward-modal');
            document.getElementById('rew-img').src = item.img;
            document.getElementById('rew-name').innerText = item.name;
            document.getElementById('rew-price').innerText = item.price;
            
            modal.classList.add('active');
            
            // –ó–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø—Ä–µ–¥–º–µ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, –∞ —Å—Ä–∞–∑—É –≤–∞–ª—é—Ç–∞. 
            // –û–±—ã—á–Ω–æ –≤ —Ç–∞–∫–∏—Ö –∏–≥—Ä–∞—Ö –ø—Ä–µ–¥–º–µ—Ç –ø–∞–¥–∞–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –Ω–æ —Ç—É—Ç –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ —Å—Ä–∞–∑—É –ø—Ä–æ–¥–∞–¥–∏–º)
            // balance += item.price; // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–µ–Ω—å–≥–∏
            // updateBal();
        }

        function closeReward() {
            document.getElementById('reward-modal').classList.remove('active');
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–∏–¥
            // document.getElementById('roulette-box').style.display = 'none';
            // document.getElementById('static-case-img').style.display = 'block';
        }

        // –î–∞–Ω–Ω—ã–µ —é–∑–µ—Ä–∞ –∏–∑ –¢–µ–ª–µ–≥—Ä–∞–º
        const u = tg.initDataUnsafe?.user;
        if(u) {
            document.getElementById('p-name').innerText = u.first_name;
            if(u.photo_url) {
                document.getElementById('p-img').style.backgroundImage = `url(${u.photo_url})`;
            }
        }
    </script>
</body>
</html>
