<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gifts Battle LUXURY VIP Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        /* ==========================================================================
           1. ПЕРЕМЕННЫЕ И ОСНОВНЫЕ ЦВЕТА (LUXURY PALETTE)
           ========================================================================== */
        :root {
            --luxury-gold: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --luxury-bg: #05070a;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            
            --common: #b2bec3;
            --rare: #00cec9;
            --epic: #a29bfe;
            --legendary: #fdcb6e;
            --mythic: #ff7675;
            
            --accent-blue: #3d5afe;
            --danger: #ff4757;
            --success: #2ed573;
            
            --font-main: 'Inter', -apple-system, sans-serif;
        }

        /* ==========================================================================
           2. ГЛОБАЛЬНЫЕ СТИЛИ
           ========================================================================== */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--luxury-bg);
            color: #fff;
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            overflow: hidden;
            user-select: none;
        }

        /* Кастомный скроллбар */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

        /* ==========================================================================
           3. АНИМАЦИИ (PULSE, SHAKE, GLOW)
           ========================================================================== */
        @keyframes luxuryPulse {
            0% { box-shadow: 0 0 0 0 rgba(189, 149, 63, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(189, 149, 63, 0); }
            100% { box-shadow: 0 0 0 0 rgba(189, 149, 63, 0); }
        }

        @keyframes bgGlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .pulse-gold { animation: luxuryPulse 2s infinite; }

        /* ==========================================================================
           4. ШАПКА (PREMIUM HEADER)
           ========================================================================== */
        .luxury-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(5, 7, 10, 0.8);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .brand-logo {
            font-size: 20px;
            font-weight: 900;
            letter-spacing: 2px;
            background: var(--luxury-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wallet-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--glass-bg);
            padding: 8px 16px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .wallet-container:active { transform: scale(0.95); }

        /* ==========================================================================
           5. ГЛАВНЫЙ КОНТЕЙНЕР
           ========================================================================== */
        .main-view {
            height: calc(100vh - 150px);
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 100px;
        }

        .screen { display: none; opacity: 0; transform: translateY(20px); transition: all 0.4s ease; }
        .screen.active { display: block; opacity: 1; transform: translateY(0); }

        /* ==========================================================================
           6. МОДУЛЬ: BULLDROP DOUBLE
           ========================================================================== */
        .game-card {
            background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 100%);
            border-radius: 30px;
            border: 1px solid var(--glass-border);
            padding: 25px 0;
            margin-bottom: 20px;
            position: relative;
        }

        .roulette-wrapper {
            width: 100%;
            height: 110px;
            background: #000;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
            border-top: 1px solid rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .pointer {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: gold;
            z-index: 50;
            transform: translateX(-50%);
            box-shadow: 0 0 20px gold;
        }

        .track {
            display: flex;
            position: absolute;
            left: 0;
            height: 100%;
            align-items: center;
            will-change: transform;
        }

        .cell {
            min-width: 80px;
            height: 80px;
            margin: 0 6px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 22px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* ==========================================================================
           7. ИНВЕНТАРЬ И ПРЕДМЕТЫ
           ========================================================================== */
        .item-card {
            background: var(--glass-bg);
            border-radius: 24px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            transition: 0.3s;
        }

        .item-card::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 5px;
        }

        .item-card.common::after { background: var(--common); }
        .item-card.rare::after { background: var(--rare); box-shadow: 0 0 15px var(--rare); }
        .item-card.epic::after { background: var(--epic); box-shadow: 0 0 15px var(--epic); }
        .item-card.legendary::after { background: var(--legendary); box-shadow: 0 0 15px var(--legendary); }

        /* ==========================================================================
           8. ПРОМОКОДЫ (VOUCHERS)
           ========================================================================== */
        .promo-input-group {
            display: flex;
            gap: 10px;
            background: var(--glass-bg);
            padding: 10px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .promo-input-group input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            padding-left: 10px;
            font-weight: 700;
            outline: none;
        }

        /* ==========================================================================
           9. НИЖНЯЯ ПАНЕЛЬ (TAB BAR)
           ========================================================================== */
        .tab-bar {
            position: fixed;
            bottom: 25px;
            left: 20px;
            right: 20px;
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            height: 70px;
            border-radius: 25px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 2000;
        }

        .tab-item {
            color: #666;
            text-align: center;
            transition: 0.3s;
        }

        .tab-item.active {
            color: #fff;
            transform: translateY(-5px);
        }

        .tab-item i { font-size: 24px; display: block; }
        .tab-item span { font-size: 10px; font-weight: 700; }
    </style>
</head>
<body>

    <header class="luxury-header">
        <div class="brand-logo">LUXURY BATTLE</div>
        <div class="wallet-container pulse-gold" onclick="hapticSoft()">
            <img src="https://img.icons8.com/emoji/48/star-emoji.png" width="20">
            <span id="balance-val" style="font-weight: 900;">10,000</span>
        </div>
    </header>

    <main class="main-view">
        
        <div id="scr-games" class="screen active">
            <div style="margin-bottom: 20px;">
                <h1 style="margin:0; font-size: 28px;">The Double</h1>
                <p style="color: var(--text-gray); font-size: 13px; margin: 5px 0;">Испытай удачу в Luxury сегменте</p>
            </div>

            <div class="game-card">
                <div class="roulette-wrapper">
                    <div class="pointer"></div>
                    <div id="roulette-track" class="track"></div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 0 15px;">
                    <button class="bet-btn" onclick="selectColor(2, this)" style="background: #2d3436; border-radius: 15px; border: 2px solid transparent; padding: 15px 0; color: #fff;">
                        <b>2x</b><br><small>GRAY</small>
                    </button>
                    <button class="bet-btn" onclick="selectColor(3, this)" style="background: var(--success); border-radius: 15px; border: 2px solid transparent; padding: 15px 0; color: #fff;">
                        <b>3x</b><br><small>GREEN</small>
                    </button>
                    <button class="bet-btn" onclick="selectColor(5, this)" style="background: var(--danger); border-radius: 15px; border: 2px solid transparent; padding: 15px 0; color: #fff;">
                        <b>5x</b><br><small>RED</small>
                    </button>
                    <button class="bet-btn" onclick="selectColor(50, this)" style="background: var(--luxury-gold); border-radius: 15px; border: 2px solid transparent; padding: 15px 0; color: #000;">
                        <b>50x</b><br><small>GOLD</small>
                    </button>
                </div>

                <div style="padding: 20px;">
                    <div class="promo-input-group">
                        <i class="fas fa-coins" style="margin: auto 0; color: gold;"></i>
                        <input type="number" id="bet-input" value="100" placeholder="Ставка...">
                        <button onclick="setBet('max')" style="background: none; border: none; color: gold; font-weight: 800;">MAX</button>
                    </div>
                    <button id="spin-btn" class="main-btn pulse-gold" onclick="startLuxurySpin()" style="width: 100%; margin-top: 15px; padding: 20px; border-radius: 20px; border: none; background: #fff; color: #000; font-weight: 900; font-size: 18px;">
                        ЗАКРУТИТЬ БАРАБАН
                    </button>
                </div>
            </div>

            <div id="history-line" style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px;"></div>
        </div>

        <div id="scr-cases" class="screen">
            <h1 style="margin:0 0 20px;">Premium Cases</h1>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="item-card rare" onclick="openCase('tech')">
                    <img src="https://img.icons8.com/3d-fluency/94/iphone-14-pro.png" width="60">
                    <h3>Apple Case</h3>
                    <p style="font-size: 12px; color: gold;">500 Stars</p>
                </div>
                <div class="item-card legendary" onclick="openCase('luxury')">
                    <img src="https://img.icons8.com/3d-fluency/94/diamond.png" width="60">
                    <h3>CEO Case</h3>
                    <p style="font-size: 12px; color: gold;">2,500 Stars</p>
                </div>
            </div>
        </div>

        <div id="scr-profile" class="screen">
            <div style="text-align: center; padding: 20px 0;">
                <div id="user-avatar" class="pulse-gold" style="width: 100px; height: 100px; border-radius: 50%; margin: 0 auto; background-size: cover; border: 3px solid #fff;"></div>
                <h2 id="user-name" style="margin: 15px 0 5px;">Player Name</h2>
                <span style="color: var(--legendary); font-weight: 800;">LUXURY MEMBER</span>
            </div>

            <div style="margin-top: 20px;">
                <label style="font-size: 12px; color: #666; margin-left: 10px;">АКТИВАЦИЯ ВАУЧЕРА</label>
                <div class="promo-input-group" style="margin-top: 5px;">
                    <input type="text" id="promo-code" placeholder="Введите промокод...">
                    <button onclick="activatePromo()" style="background: var(--luxury-gold); border: none; padding: 0 20px; border-radius: 12px; font-weight: 900;">OK</button>
                </div>
            </div>

            <h3 style="margin-top: 30px;">Инвентарь</h3>
            <div id="inventory-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                </div>
        </div>

    </main>

    <nav class="tab-bar">
        <div class="tab-item active" onclick="switchTab('games', this)">
            <i class="fas fa-gamepad"></i>
            <span>ИГРЫ</span>
        </div>
        <div class="tab-item" onclick="switchTab('cases', this)">
            <i class="fas fa-briefcase"></i>
            <span>КЕЙСЫ</span>
        </div>
        <div class="tab-item" onclick="switchTab('profile', this)">
            <i class="fas fa-user-tie"></i>
            <span>VIP</span>
        </div>
    </nav>

    <script>
        /* ==========================================================================
           10. ЛОГИКА И СКРИПТЫ (CORE ENGINE)
           ========================================================================== */
        const tg = window.Telegram.WebApp;
        tg.expand();

        // СОСТОЯНИЕ (STATE)
        let state = {
            balance: parseInt(localStorage.getItem('lux_bal')) || 15000,
            inventory: JSON.parse(localStorage.getItem('lux_inv')) || [],
            activeColor: null,
            isSpinning: false,
            usedPromos: JSON.parse(localStorage.getItem('lux_promos')) || []
        };

        // БАЗА ДАННЫХ ПРЕДМЕТОВ
        const ITEMS_DB = {
            tech: [
                { id: 1, name: 'AirPods 3', price: 150, rarity: 'rare', img: 'https://img.icons8.com/3d-fluency/94/airpods-pro.png' },
                { id: 2, name: 'iPhone 15', price: 1200, rarity: 'epic', img: 'https://img.icons8.com/3d-fluency/94/iphone-14-pro.png' },
                { id: 3, name: 'MacBook M3', price: 2500, rarity: 'legendary', img: 'https://img.icons8.com/3d-fluency/94/macbook.png' }
            ],
            luxury: [
                { id: 4, name: 'Rolex Sub', price: 15000, rarity: 'mythic', img: 'https://img.icons8.com/3d-fluency/94/watch.png' },
                { id: 5, name: 'Gold Bar', price: 5000, rarity: 'legendary', img: 'https://img.icons8.com/3d-fluency/94/ingot.png' }
            ]
        };

        // ИНИЦИАЛИЗАЦИЯ ТРЕКА РУЛЕТКИ
        const pattern = [2, 3, 2, 5, 2, 3, 2, 5, 2, 3, 2, 50, 2, 5, 2, 3, 2, 5, 2, 3];
        function buildTrack() {
            const track = document.getElementById('roulette-track');
            track.innerHTML = '';
            for(let i=0; i<100; i++) {
                const val = pattern[i % pattern.length];
                const div = document.createElement('div');
                div.className = 'cell';
                if(val === 2) div.style.background = '#2d3436';
                if(val === 3) div.style.background = '#2ed573';
                if(val === 5) div.style.background = '#ff4757';
                if(val === 50) div.style.background = 'gold', div.style.color = '#000';
                div.innerHTML = `<small style="font-size:10px; opacity:0.5">X</small>${val}`;
                track.appendChild(div);
            }
        }
        buildTrack();

        // СИСТЕМА ОБНОВЛЕНИЯ UI
        function syncUI() {
            document.getElementById('balance-val').innerText = state.balance.toLocaleString();
            localStorage.setItem('lux_bal', state.balance);
            localStorage.setItem('lux_inv', JSON.stringify(state.inventory));
            localStorage.setItem('lux_promos', JSON.stringify(state.usedPromos));
            renderInventory();
        }

        // КНОПКИ СТАВОК
        function selectColor(mul, btn) {
            if(state.isSpinning) return;
            state.activeColor = mul;
            document.querySelectorAll('.bet-btn').forEach(b => b.style.borderColor = 'transparent');
            btn.style.borderColor = '#fff';
            tg.HapticFeedback.selectionChanged();
        }

        function setBet(type) {
            const input = document.getElementById('bet-input');
            if(type === 'max') input.value = state.balance;
            hapticSoft();
        }

        // ЛОГИКА СПИНА
        function startLuxurySpin() {
            const bet = parseInt(document.getElementById('bet-input').value);
            if(state.isSpinning || !state.activeColor || bet > state.balance || bet <= 0) {
                tg.showAlert("Проверьте ставку или цвет!");
                return;
            }

            state.isSpinning = true;
            state.balance -= bet;
            syncUI();
            hapticHeavy();

            const track = document.getElementById('roulette-track');
            const winIdx = 70 + Math.floor(Math.random() * 20);
            const winVal = pattern[winIdx % pattern.length];
            
            const cellWidth = 92; // 80 + 12 margin
            const offset = (winIdx * cellWidth) - (window.innerWidth / 2) + (cellWidth / 2);

            track.style.transition = 'transform 7s cubic-bezier(0.15, 0, 0.05, 1)';
            track.style.transform = `translateX(-${offset}px)`;

            // Звуковая имитация тиканья через вибрацию
            let ticks = 0;
            const tickInterval = setInterval(() => {
                ticks++;
                if(ticks < 50) tg.HapticFeedback.impactOccurred('light');
                if(ticks > 60) clearInterval(tickInterval);
            }, 100);

            setTimeout(() => {
                state.isSpinning = false;
                if(winVal === state.activeColor) {
                    const winAmount = bet * winVal;
                    state.balance += winAmount;
                    tg.showPopup({ title: 'LUXURY WIN', message: `Вы выиграли ${winAmount} Stars!`, buttons: [{type:'ok'}] });
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                
                addHistory(winVal);
                syncUI();

                setTimeout(() => {
                    track.style.transition = 'none';
                    track.style.transform = 'translateX(0)';
                    buildTrack();
                }, 1000);
            }, 7500);
        }

        function addHistory(val) {
            const container = document.getElementById('history-line');
            const item = document.createElement('div');
            item.style.minWidth = '30px';
            item.style.height = '30px';
            item.style.borderRadius = '8px';
            item.style.background = val === 2 ? '#2d3436' : (val === 3 ? '#2ed573' : (val === 5 ? '#ff4757' : 'gold'));
            container.prepend(item);
        }

        // МОДУЛЬ КЕЙСОВ
        function openCase(type) {
            const cost = type === 'tech' ? 500 : 2500;
            if(state.balance < cost) {
                tg.showAlert("Недостаточно средств!");
                return;
            }

            state.balance -= cost;
            hapticHeavy();
            
            // Простая логика выпадения
            const pool = ITEMS_DB[type];
            const drop = pool[Math.floor(Math.random() * pool.length)];
            
            state.inventory.push(drop);
            syncUI();
            
            tg.showPopup({
                title: 'НОВЫЙ ПРЕДМЕТ',
                message: `Вы выбили: ${drop.name}`,
                buttons: [{type: 'ok'}]
            });
        }

        // МОДУЛЬ ПРОМОКОДОВ (РАБОЧИЕ)
        function activatePromo() {
            const code = document.getElementById('promo-code').value.toUpperCase();
            
            if(state.usedPromos.includes(code)) {
                tg.showAlert("Вы уже использовали этот код!");
                return;
            }

            const rewards = {
                "LUXURY": 5000,
                "GIFT2024": 1000,
                "TON": 2500,
                "ADMIN": 100000
            };

            if(rewards[code]) {
                state.balance += rewards[code];
                state.usedPromos.push(code);
                syncUI();
                tg.showPopup({ title: 'УСПЕХ', message: `Начислено ${rewards[code]} Stars!`, buttons: [{type:'ok'}] });
                tg.HapticFeedback.notificationOccurred('success');
                document.getElementById('promo-code').value = '';
            } else {
                tg.showAlert("Неверный промокод!");
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        // РЕНДЕР ИНВЕНТАРЯ
        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            state.inventory.forEach(item => {
                const div = document.createElement('div');
                div.className = `item-card ${item.rarity} animate__animated animate__fadeIn`;
                div.innerHTML = `
                    <img src="${item.img}" width="40">
                    <p style="font-size:10px; margin:5px 0 0;">${item.name}</p>
                `;
                grid.appendChild(div);
            });
        }

        // НАВИГАЦИЯ
        function switchTab(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('scr-' + id).classList.add('active');
            
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            hapticSoft();
        }

        // ХАПТИК (ВИБРАЦИЯ)
        function hapticSoft() { tg.HapticFeedback.impactOccurred('medium'); }
        function hapticHeavy() { tg.HapticFeedback.impactOccurred('heavy'); }

        // ДАННЫЕ ЮЗЕРА
        const user = tg.initDataUnsafe?.user;
        if(user) {
            document.getElementById('user-name').innerText = user.first_name;
            if(user.photo_url) document.getElementById('user-avatar').style.backgroundImage = `url(${user.photo_url})`;
        }

        // Старт
        syncUI();
    </script>
</body>
</html>

